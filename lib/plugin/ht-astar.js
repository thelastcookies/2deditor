!function(L,y,$){"use strict";var Z=L.ht;Z.Astar={},function(Z){var R=Z();L.AStar=R.astar,L.AStar.Graph=R.Graph}(function(){function N(i){for(var O=i,x=[];O.parent;)x.unshift(O),O=O.parent;return x}function R(){return new y(function(o){return o.f})}function V(B,h){h=h||{},this.nodes=[],this.diagonal=!!h.diagonal,this.grid=[];for(var S=0;S<B.length;S++){this.grid[S]=[];for(var o=0,v=B[S];o<v.length;o++){var D=new w(S,o,v[o]);this.grid[S][o]=D,this.nodes.push(D)}}this.$13x()}function w(u,J,h){this.x=u,this.y=J,this.weight=h}function y(C){this.content=[],this.scoreFunction=C}var Y={search:function(r,E,S,I){r.$6x(),I=I||{};var h=I.heuristic;h||(h=r.diagonal?Y.$4x.diagonal:Y.$4x.manhattan);var T=I.closest||!1,K=I.punish,D=R(),W=E;for(E.h=h(E,S),r.$7x(E),D.push(E);D.size()>0;){var g=D.pop();if(g===S)return N(g);g.closed=!0;for(var A=r.neighbors(g),s=0,U=A.length;U>s;++s){var J=A[s];if(!J.closed&&!J.$9x()){var Z=g.g+J.getCost(g,K),u=J.visited;(!u||Z<J.g)&&(J.visited=!0,J.parent=g,J.h=J.h||h(J,S),J.g=Z,J.f=J.g+J.h,r.$7x(J),T&&(J.h<W.h||J.h===W.h&&J.g<W.g)&&(W=J),u?D.$10x(J):D.push(J))}}}return T?N(W):[]},$4x:{manhattan:function(R,N){var i=Math.abs(N.x-R.x),g=Math.abs(N.y-R.y);return i+g},diagonal:function(q,d){var W=1,v=Math.sqrt(2),T=Math.abs(d.x-q.x),Y=Math.abs(d.y-q.y);return W*(T+Y)+(v-2*W)*Math.min(T,Y)}},$5x:function(W){W.f=0,W.g=0,W.h=0,W.visited=!1,W.closed=!1,W.parent=null}};return V.prototype.$13x=function(){this.dirtyNodes=[];for(var E=0;E<this.nodes.length;E++)Y.$5x(this.nodes[E])},V.prototype.$6x=function(){for(var x=0;x<this.dirtyNodes.length;x++)Y.$5x(this.dirtyNodes[x]);this.dirtyNodes=[]},V.prototype.$7x=function(s){this.dirtyNodes.push(s)},V.prototype.neighbors=function(u){var f=[],B=u.x,G=u.y,R=this.grid;return R[B-1]&&R[B-1][G]&&f.push(R[B-1][G]),R[B+1]&&R[B+1][G]&&f.push(R[B+1][G]),R[B]&&R[B][G-1]&&f.push(R[B][G-1]),R[B]&&R[B][G+1]&&f.push(R[B][G+1]),this.diagonal&&(R[B-1]&&R[B-1][G-1]&&f.push(R[B-1][G-1]),R[B+1]&&R[B+1][G-1]&&f.push(R[B+1][G-1]),R[B-1]&&R[B-1][G+1]&&f.push(R[B-1][G+1]),R[B+1]&&R[B+1][G+1]&&f.push(R[B+1][G+1])),f},V.prototype.toString=function(){for(var Y=[],M=this.grid,U=0;U<M.length;U++){for(var z=[],W=M[U],D=0;D<W.length;D++)z.push(W[D].weight);Y.push(z.join(" "))}return Y.join("\n")},w.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},w.prototype.getCost=function(k,V){var s;if(s=k&&k.x!=this.x&&k.y!=this.y?1.41421*this.weight:this.weight,V){var g=k;if(!g)return s;var O=g.parent;return O?Math.abs(O.x+this.x-2*g.x)>1e-5?s+V:Math.abs(O.y+this.y-2*g.y)>1e-5?s+V:s:s}},w.prototype.$9x=function(){return 0===this.weight},y.prototype={push:function(i){this.content.push(i),this.$11x(this.content.length-1)},pop:function(){var p=this.content[0],d=this.content.pop();return this.content.length>0&&(this.content[0]=d,this.$12x(0)),p},remove:function(H){var Z=this.content.indexOf(H),Q=this.content.pop();Z!==this.content.length-1&&(this.content[Z]=Q,this.scoreFunction(Q)<this.scoreFunction(H)?this.$11x(Z):this.$12x(Z))},size:function(){return this.content.length},$10x:function(W){this.$11x(this.content.indexOf(W))},$11x:function(A){for(var y=this.content[A];A>0;){var p=(A+1>>1)-1,R=this.content[p];if(!(this.scoreFunction(y)<this.scoreFunction(R)))break;this.content[p]=y,this.content[A]=R,A=p}},$12x:function(d){for(var n=this.content.length,V=this.content[d],L=this.scoreFunction(V);;){var g,X=d+1<<1,o=X-1,O=null;if(n>o){var m=this.content[o];g=this.scoreFunction(m),L>g&&(O=o)}if(n>X){var $=this.content[X],q=this.scoreFunction($);(null===O?L:g)>q&&(O=X)}if(null===O)break;this.content[d]=this.content[O],this.content[O]=V,d=O}}},{astar:Y,Graph:V}});var I=Z.Astar.Finder=function(U,L){var r=this;r.gv=U,r.$13x(L),r.refreshMap()};I.prototype={},I.prototype.constructor=I,y.defineProperties(I.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(r){this.gv._astarDebugInfo=r}}}),I.prototype.$13x=function(N){var I=this,r=I.$14x={};N=N||{};var S=N.gridSize||10;r.gridSizeX=N.gridSizeX||S,r.gridSizeY=N.gridSizeY||S,r.rect=N.rect,r.filter=N.filter,r.extendBlocks=N.extendBlocks||3,r.fastOverlap=N.fastOverlap===$?!0:N.fastOverlap,r.nodeRectExtend=N.nodeRectExtend||0,r.diagonal=N.diagonal===$?!0:N.diagonal,r.turnPunish=N.turnPunish===$?.1:N.turnPunish,r.simplify=N.simplify===$?!0:N.simplify,r.toGridCenter=N.toGridCenter===$?!1:N.toGridCenter,r.closest=N.closest===$?!0:N.closest},I.prototype.refreshMap=function(){var j,g=this,d=g.$14x,A=d.gridSizeX,s=d.gridSizeY,C=d.extendBlocks;d.rect?j=d.rect:(j=g.$15x(),Z.Default.grow(j,A*C,s*C)),Z.Default.grow(j,A,s);var $=Math.floor(j.x/A)*A,u=Math.floor(j.y/s)*s,Y=Math.ceil(j.width/A),J=Math.ceil(j.height/s),M=Y*A,h=J*s;g.$16x={x:$,y:u,w:M,h:h,gridX:A,gridY:s,xLen:Y,yLen:J},g.$17x(),g.$21x()},I.prototype.$15x=function(){var j=this.gv;if(j instanceof Z.graph.GraphView)return j.getContentRect();var b,Y=Z.Default.unionRect;return j.dm().each(function(P){j.isVisible(P)&&P.getRect&&(b=Y(b,P.getRect()))}),b},I.prototype.$17x=function(){var Q,J,F,e,s=this,M=s.$16x,P=M.xLen,o=M.yLen;for(Q=new Array(P),F=0;P>F;F++)for(Q[F]=J=new Array(o),e=o;e--;)J[e]=1;var z=s.$14x.filter;for(s.gv.dm().each(function(x){z&&z(x)===!1||(!s._debugInfo||x!==s._debugInfo.grid&&x!=s._debugInfo.path)&&s.$1cw(Q,x)}),F=0;P>F;F++)Q[F][0]=1,Q[F][o-1]=1;for(e=0;o>e;e++)Q[0][e]=1,Q[P-1][e]=1;s.grid=Q;var H=new AStar.Graph(Q,{diagonal:s.$14x.diagonal});s.graph=H},I.prototype.$18x=function(z,J,g,w,D,v,S,h){var H=this.$19x,t=H(g-z,D-S,w-J,v-h);if(1e-6>=t&&t>=-1e-6)return!1;var k=H(D-z,D-S,v-J,v-h)/t;if(0>k||k>1)return!1;var r=H(g-z,D-z,w-J,v-J)/t;return 0>r||r>1?!1:!0},I.prototype.$19x=function(e,j,u,I){return e*I-j*u},I.prototype.$1aw=function(C,G,O,P){for(var j=[-(G[1]-C[1]),G[0]-C[0]],y=j[0]*(O[0]-C[0])+j[1]*(O[1]-C[1])>=0,l=0,t=P.length;t>l;l+=2)if(j[0]*(P[l]-C[0])+j[1]*(P[l+1]-C[1])>=0===y)return!1;return!0},I.prototype.$1bw=function(I,r){for(var X,u,g=this,G=0,t=I.length;t>G;G+=2)if(X=G===t-2?0:G+2,u=X===t-2?0:X+2,g.$1aw([I[G],I[G+1]],[I[X],I[X+1]],[I[u],I[u+1]],r))return!1;for(var G=0,t=r.length;t>G;G+=2)if(X=G===t-2?0:G+2,u=X===t-2?0:X+2,g.$1aw([r[G],r[G+1]],[r[X],r[X+1]],[r[u],r[u+1]],I))return!1;return!0},I.prototype.$1cw=function(j,B){if(B.getRect){var i=this,M=B.getRect();Z.Default.grow(M,i.$14x.nodeRectExtend);var q,w,N,K,A,U,n,F,o,R,X,d=i.$1dw({x:M.x,y:M.y}),$=i.$1dw({x:M.x+M.width,y:M.y+M.height}),t=i.$14x.fastOverlap;if(!t){var I=B.getCorners();n=[],I.forEach(function(q){n.push(q.x,q.y)}),R=i.$14x.gridSizeX/2,X=i.$14x.gridSizeY/2}for(w=Math.max(0,d.x),N=Math.min($.x,j.length-1),A=Math.max(0,d.y),U=Math.min($.y,j.length?j[0].length-1:-1),q=w;N>=q;q++)for(K=A;U>=K;K++)if(t)j[q][K]=0;else{o=i.$1ew({x:q,y:K});var y=o.x-R,C=o.x+R,G=o.y-X,f=o.y+X;F=[y,G,y,f,C,f,C,G],i.$1bw(n,F)&&(j[q][K]=0)}}},I.prototype.$1dw=function(E,P){var X=this,H=X.$16x,Y=(E.x-H.x)/H.gridX,c=(E.y-H.y)/H.gridY;return P!==!1&&(Y=Math.round(Y),c=Math.round(c)),{x:Y,y:c}},I.prototype.$1ew=function(q){var w=this,R=w.$16x;return{x:q.x*R.gridX+R.x,y:q.y*R.gridY+R.y}},I.prototype.$1fw=function($){var e=this,s=e.$16x,k=s.xLen,G=s.yLen;if($.x>=0&&$.x<k&&$.y>=0&&$.y<G)return $;var r={x:$.x,y:$.y};return r.x<0?r.x=0:r.x>=k&&(r.x=k-1),r.y<0?r.y=0:r.y>=G&&(r.y=G-1),r},I.prototype.findPath=function(R,S){var A,h,N,L,i=this,B=i.$1dw(R),l=i.$1dw(S);if(N=i.$1fw(B),L=i.$1fw(l),N!==B&&L!==l){var H=i.$16x,Y=H.x-H.gridX/2,t=H.y-H.gridY/2,o=Y+H.gridX*H.xLen,y=t+H.gridY*H.yLen;if(!(i.$18x(R.x,R.y,S.x,S.y,Y,t,o,t)||i.$18x(R.x,R.y,S.x,S.y,o,t,o,y)||i.$18x(R.x,R.y,S.x,S.y,o,y,Y,y)||i.$18x(R.x,R.y,S.x,S.y,Y,y,Y,t)))return[R,S]}N!==B&&(A=!0,B=N),L!==l&&(h=!0,l=L);var T=i.graph.grid[B.x][B.y],Q=i.graph.grid[l.x][l.y],J=AStar.search(i.graph,T,Q,{closest:i.$14x.closest,punish:i.$14x.turnPunish});if(!J||!J.length)return null;var U=[];U.push(R),A&&U.push(i.$1ew(J[0]));for(var g=1,X=J.length;X-1>g;g++)U.push(i.$1ew(J[g]));if(h)U.push(i.$1ew(J[X-1])),U.push(S);else{var z=J[X-1];l.x!==z.x||l.y!==z.y||i.$14x.toGridCenter?U.push(i.$1ew(z)):U.push(S)}return i.$14x.simplify&&(U=i.simplifyPath(U)),i.$20x=U,i.$21x(),U},I.prototype.debugOn=function(r){this.debugFlag=!0,this.debugSettings=r||{},this.$21x()},I.prototype.simplifyPath=function(B){var F=B.length;if(2>=F)return B;var o,S,e=[B[0],B[1]],R=e[0],k=e[1],_=1e-5;for(o=2;F>o;o++)S=B[o],Math.abs((k.x-R.x)*(S.y-R.y)-(k.y-R.y)*(S.x-R.x))<_?k=e[e.length-1]=S:(R=k,k=S,e.push(S));return e},I.prototype.$21x=function(){var e=this;if(e.$22x(),this.debugFlag){var b=e.grid;if(b){var U,o=e.gv;if(e.debugSettings.$16x!==!1){U=[];for(var F,B,x,y,C,t=[],r=e.$14x.gridSizeX/2,O=e.$14x.gridSizeY/2,E=b.length,h=E?b[0].length:0,v=1;E-1>v;v++)for(var A=1;h-1>A;A++)b[v][A]||(F=e.$1ew({x:v,y:A}),B=F.x-r,x=F.x+r,y=F.y-O,C=F.y+O,U.push({x:B,y:y},{x:B,y:C},{x:x,y:C},{x:x,y:y}),t.push(1,2,2,2,5));var j=new Z.Shape;j.s("shape.border.color","rgba(50, 50, 50, 0.2)"),j.s("shape.border.width",1),j.s("shape.background","rgba(200, 50, 100, 0.2)"),j.s("2d.editable",!1),j.s("2d.selectable",!1),j.setPoints(U),j.setSegments(t),e._debugInfo={grid:j},o.dm().add(j)}e.debugSettings.path!==!1&&(U=new Z.Shape,e.$20x&&(U.setPoints(e.$20x),U.s("shape.border.color","red"),U.s("shape.border.width",1),U.s("2d.editable",!1),U.s("2d.selectable",!1),U.s("shape.background",null),e._debugInfo||(e._debugInfo={}),e._debugInfo.path=U,o.dm().add(U)))}}},I.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},I.prototype.$22x=function(){var p=this;if(p._debugInfo){var d=p._debugInfo.grid,e=p._debugInfo.path,t=p.gv;d&&t.dm().remove(d),e&&t.dm().remove(e),p._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);