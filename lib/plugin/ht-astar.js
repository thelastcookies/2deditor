!function(o,b,M){"use strict";var j=o.ht;j.Astar={},function(l){var R=l();o.AStar=R.astar,o.AStar.Graph=R.Graph}(function(){function L(V){for(var $=V,b=[];$.parent;)b.unshift($),$=$.parent;return b}function O(){return new b(function(E){return E.f})}function K(K,p){p=p||{},this.nodes=[],this.diagonal=!!p.diagonal,this.grid=[];for(var M=0;M<K.length;M++){this.grid[M]=[];for(var b=0,B=K[M];b<B.length;b++){var g=new _(M,b,B[b]);this.grid[M][b]=g,this.nodes.push(g)}}this.$13x()}function _(H,h,r){this.x=H,this.y=h,this.weight=r}function b(Z){this.content=[],this.scoreFunction=Z}var I={search:function(s,N,E,i){s.$6x(),i=i||{};var T=i.heuristic;T||(T=s.diagonal?I.$4x.diagonal:I.$4x.manhattan);var U=i.closest||!1,R=i.punish,G=O(),B=N;for(N.h=T(N,E),s.$7x(N),G.push(N);G.size()>0;){var v=G.pop();if(v===E)return L(v);v.closed=!0;for(var Q=s.neighbors(v),o=0,C=Q.length;C>o;++o){var $=Q[o];if(!$.closed&&!$.$9x()){var M=v.g+$.getCost(v,R),n=$.visited;(!n||M<$.g)&&($.visited=!0,$.parent=v,$.h=$.h||T($,E),$.g=M,$.f=$.g+$.h,s.$7x($),U&&($.h<B.h||$.h===B.h&&$.g<B.g)&&(B=$),n?G.$10x($):G.push($))}}}return U?L(B):[]},$4x:{manhattan:function(E,Q){var J=Math.abs(Q.x-E.x),K=Math.abs(Q.y-E.y);return J+K},diagonal:function(T,b){var m=1,W=Math.sqrt(2),w=Math.abs(b.x-T.x),i=Math.abs(b.y-T.y);return m*(w+i)+(W-2*m)*Math.min(w,i)}},$5x:function(Q){Q.f=0,Q.g=0,Q.h=0,Q.visited=!1,Q.closed=!1,Q.parent=null}};return K.prototype.$13x=function(){this.dirtyNodes=[];for(var h=0;h<this.nodes.length;h++)I.$5x(this.nodes[h])},K.prototype.$6x=function(){for(var D=0;D<this.dirtyNodes.length;D++)I.$5x(this.dirtyNodes[D]);this.dirtyNodes=[]},K.prototype.$7x=function(J){this.dirtyNodes.push(J)},K.prototype.neighbors=function(s){var A=[],O=s.x,P=s.y,C=this.grid;return C[O-1]&&C[O-1][P]&&A.push(C[O-1][P]),C[O+1]&&C[O+1][P]&&A.push(C[O+1][P]),C[O]&&C[O][P-1]&&A.push(C[O][P-1]),C[O]&&C[O][P+1]&&A.push(C[O][P+1]),this.diagonal&&(C[O-1]&&C[O-1][P-1]&&A.push(C[O-1][P-1]),C[O+1]&&C[O+1][P-1]&&A.push(C[O+1][P-1]),C[O-1]&&C[O-1][P+1]&&A.push(C[O-1][P+1]),C[O+1]&&C[O+1][P+1]&&A.push(C[O+1][P+1])),A},K.prototype.toString=function(){for(var Y=[],p=this.grid,b=0;b<p.length;b++){for(var F=[],k=p[b],L=0;L<k.length;L++)F.push(k[L].weight);Y.push(F.join(" "))}return Y.join("\n")},_.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},_.prototype.getCost=function(r,o){var S;if(S=r&&r.x!=this.x&&r.y!=this.y?1.41421*this.weight:this.weight,o){var H=r;if(!H)return S;var M=H.parent;return M?Math.abs(M.x+this.x-2*H.x)>1e-5?S+o:Math.abs(M.y+this.y-2*H.y)>1e-5?S+o:S:S}},_.prototype.$9x=function(){return 0===this.weight},b.prototype={push:function(e){this.content.push(e),this.$11x(this.content.length-1)},pop:function(){var w=this.content[0],$=this.content.pop();return this.content.length>0&&(this.content[0]=$,this.$12x(0)),w},remove:function(H){var $=this.content.indexOf(H),J=this.content.pop();$!==this.content.length-1&&(this.content[$]=J,this.scoreFunction(J)<this.scoreFunction(H)?this.$11x($):this.$12x($))},size:function(){return this.content.length},$10x:function(x){this.$11x(this.content.indexOf(x))},$11x:function(C){for(var F=this.content[C];C>0;){var u=(C+1>>1)-1,f=this.content[u];if(!(this.scoreFunction(F)<this.scoreFunction(f)))break;this.content[u]=F,this.content[C]=f,C=u}},$12x:function(h){for(var o=this.content.length,c=this.content[h],O=this.scoreFunction(c);;){var w,p=h+1<<1,D=p-1,V=null;if(o>D){var N=this.content[D];w=this.scoreFunction(N),O>w&&(V=D)}if(o>p){var v=this.content[p],R=this.scoreFunction(v);(null===V?O:w)>R&&(V=p)}if(null===V)break;this.content[h]=this.content[V],this.content[V]=c,h=V}}},{astar:I,Graph:K}});var n=j.Astar.Finder=function(i,W){var l=this;l.gv=i,l.$13x(W),l.refreshMap()};n.prototype={},n.prototype.constructor=n,b.defineProperties(n.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(l){this.gv._astarDebugInfo=l}}}),n.prototype.$13x=function(q){var v=this,k=v.$14x={};q=q||{};var A=q.gridSize||10;k.gridSizeX=q.gridSizeX||A,k.gridSizeY=q.gridSizeY||A,k.rect=q.rect,k.filter=q.filter,k.extendBlocks=q.extendBlocks||3,k.fastOverlap=q.fastOverlap===M?!0:q.fastOverlap,k.nodeRectExtend=q.nodeRectExtend||0,k.diagonal=q.diagonal===M?!0:q.diagonal,k.turnPunish=q.turnPunish===M?.1:q.turnPunish,k.simplify=q.simplify===M?!0:q.simplify,k.toGridCenter=q.toGridCenter===M?!1:q.toGridCenter,k.closest=q.closest===M?!0:q.closest},n.prototype.refreshMap=function(){var b,E=this,K=E.$14x,z=K.gridSizeX,x=K.gridSizeY,F=K.extendBlocks;K.rect?b=K.rect:(b=E.$15x(),j.Default.grow(b,z*F,x*F)),j.Default.grow(b,z,x);var t=Math.floor(b.x/z)*z,A=Math.floor(b.y/x)*x,P=Math.ceil(b.width/z),d=Math.ceil(b.height/x),U=P*z,Q=d*x;E.$16x={x:t,y:A,w:U,h:Q,gridX:z,gridY:x,xLen:P,yLen:d},E.$17x(),E.$21x()},n.prototype.$15x=function(){var M=this.gv;if(M instanceof j.graph.GraphView)return M.getContentRect();var q,o=j.Default.unionRect;return M.dm().each(function(T){M.isVisible(T)&&T.getRect&&(q=o(q,T.getRect()))}),q},n.prototype.$17x=function(){var Y,w,F,o,k=this,m=k.$16x,S=m.xLen,i=m.yLen;for(Y=new Array(S),F=0;S>F;F++)for(Y[F]=w=new Array(i),o=i;o--;)w[o]=1;var U=k.$14x.filter;for(k.gv.dm().each(function(N){U&&U(N)===!1||(!k._debugInfo||N!==k._debugInfo.grid&&N!=k._debugInfo.path)&&k.$1cw(Y,N)}),F=0;S>F;F++)Y[F][0]=1,Y[F][i-1]=1;for(o=0;i>o;o++)Y[0][o]=1,Y[S-1][o]=1;k.grid=Y;var P=new AStar.Graph(Y,{diagonal:k.$14x.diagonal});k.graph=P},n.prototype.$18x=function(H,W,J,A,Z,U,x,R){var b=this.$19x,O=b(J-H,Z-x,A-W,U-R);if(1e-6>=O&&O>=-1e-6)return!1;var g=b(Z-H,Z-x,U-W,U-R)/O;if(0>g||g>1)return!1;var j=b(J-H,Z-H,A-W,U-W)/O;return 0>j||j>1?!1:!0},n.prototype.$19x=function(R,p,$,U){return R*U-p*$},n.prototype.$1aw=function(r,N,n,k){for(var K=[-(N[1]-r[1]),N[0]-r[0]],S=K[0]*(n[0]-r[0])+K[1]*(n[1]-r[1])>=0,u=0,d=k.length;d>u;u+=2)if(K[0]*(k[u]-r[0])+K[1]*(k[u+1]-r[1])>=0===S)return!1;return!0},n.prototype.$1bw=function(F,u){for(var c,$,o=this,y=0,U=F.length;U>y;y+=2)if(c=y===U-2?0:y+2,$=c===U-2?0:c+2,o.$1aw([F[y],F[y+1]],[F[c],F[c+1]],[F[$],F[$+1]],u))return!1;for(var y=0,U=u.length;U>y;y+=2)if(c=y===U-2?0:y+2,$=c===U-2?0:c+2,o.$1aw([u[y],u[y+1]],[u[c],u[c+1]],[u[$],u[$+1]],F))return!1;return!0},n.prototype.$1cw=function(D,p){if(p.getRect){var Y=this,o=p.getRect();j.Default.grow(o,Y.$14x.nodeRectExtend);var f,F,t,b,h,r,x,H,E,z,_,K=Y.$1dw({x:o.x,y:o.y}),d=Y.$1dw({x:o.x+o.width,y:o.y+o.height}),Z=Y.$14x.fastOverlap;if(!Z){var a=p.getCorners();x=[],a.forEach(function(R){x.push(R.x,R.y)}),z=Y.$14x.gridSizeX/2,_=Y.$14x.gridSizeY/2}for(F=Math.max(0,K.x),t=Math.min(d.x,D.length-1),h=Math.max(0,K.y),r=Math.min(d.y,D.length?D[0].length-1:-1),f=F;t>=f;f++)for(b=h;r>=b;b++)if(Z)D[f][b]=0;else{E=Y.$1ew({x:f,y:b});var P=E.x-z,c=E.x+z,u=E.y-_,l=E.y+_;H=[P,u,P,l,c,l,c,u],Y.$1bw(x,H)&&(D[f][b]=0)}}},n.prototype.$1dw=function(V,L){var a=this,A=a.$16x,z=(V.x-A.x)/A.gridX,N=(V.y-A.y)/A.gridY;return L!==!1&&(z=Math.round(z),N=Math.round(N)),{x:z,y:N}},n.prototype.$1ew=function(Y){var w=this,Z=w.$16x;return{x:Y.x*Z.gridX+Z.x,y:Y.y*Z.gridY+Z.y}},n.prototype.$1fw=function(N){var A=this,R=A.$16x,b=R.xLen,j=R.yLen;if(N.x>=0&&N.x<b&&N.y>=0&&N.y<j)return N;var v={x:N.x,y:N.y};return v.x<0?v.x=0:v.x>=b&&(v.x=b-1),v.y<0?v.y=0:v.y>=j&&(v.y=j-1),v},n.prototype.findPath=function(r,H){var S,Y,c,J,w=this,N=w.$1dw(r),P=w.$1dw(H);if(c=w.$1fw(N),J=w.$1fw(P),c!==N&&J!==P){var D=w.$16x,L=D.x-D.gridX/2,j=D.y-D.gridY/2,i=L+D.gridX*D.xLen,e=j+D.gridY*D.yLen;if(!(w.$18x(r.x,r.y,H.x,H.y,L,j,i,j)||w.$18x(r.x,r.y,H.x,H.y,i,j,i,e)||w.$18x(r.x,r.y,H.x,H.y,i,e,L,e)||w.$18x(r.x,r.y,H.x,H.y,L,e,L,j)))return[r,H]}c!==N&&(S=!0,N=c),J!==P&&(Y=!0,P=J);var u=w.graph.grid[N.x][N.y],I=w.graph.grid[P.x][P.y],z=AStar.search(w.graph,u,I,{closest:w.$14x.closest,punish:w.$14x.turnPunish});if(!z||!z.length)return null;var W=[];W.push(r),S&&W.push(w.$1ew(z[0]));for(var G=1,k=z.length;k-1>G;G++)W.push(w.$1ew(z[G]));if(Y)W.push(w.$1ew(z[k-1])),W.push(H);else{var _=z[k-1];P.x!==_.x||P.y!==_.y||w.$14x.toGridCenter?W.push(w.$1ew(_)):W.push(H)}return w.$14x.simplify&&(W=w.simplifyPath(W)),w.$20x=W,w.$21x(),W},n.prototype.debugOn=function(l){this.debugFlag=!0,this.debugSettings=l||{},this.$21x()},n.prototype.simplifyPath=function(c){var j=c.length;if(2>=j)return c;var l,f,a=[c[0],c[1]],T=a[0],O=a[1],z=1e-5;for(l=2;j>l;l++)f=c[l],Math.abs((O.x-T.x)*(f.y-T.y)-(O.y-T.y)*(f.x-T.x))<z?O=a[a.length-1]=f:(T=O,O=f,a.push(f));return a},n.prototype.$21x=function(){var P=this;if(P.$22x(),this.debugFlag){var O=P.grid;if(O){var I,J=P.gv;if(P.debugSettings.$16x!==!1){I=[];for(var _,g,H,A,Q,D=[],T=P.$14x.gridSizeX/2,F=P.$14x.gridSizeY/2,t=O.length,u=t?O[0].length:0,w=1;t-1>w;w++)for(var k=1;u-1>k;k++)O[w][k]||(_=P.$1ew({x:w,y:k}),g=_.x-T,H=_.x+T,A=_.y-F,Q=_.y+F,I.push({x:g,y:A},{x:g,y:Q},{x:H,y:Q},{x:H,y:A}),D.push(1,2,2,2,5));var n=new j.Shape;n.s("shape.border.color","rgba(50, 50, 50, 0.2)"),n.s("shape.border.width",1),n.s("shape.background","rgba(200, 50, 100, 0.2)"),n.s("2d.editable",!1),n.s("2d.selectable",!1),n.setPoints(I),n.setSegments(D),P._debugInfo={grid:n},J.dm().add(n)}P.debugSettings.path!==!1&&(I=new j.Shape,P.$20x&&(I.setPoints(P.$20x),I.s("shape.border.color","red"),I.s("shape.border.width",1),I.s("2d.editable",!1),I.s("2d.selectable",!1),I.s("shape.background",null),P._debugInfo||(P._debugInfo={}),P._debugInfo.path=I,J.dm().add(I)))}}},n.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},n.prototype.$22x=function(){var F=this;if(F._debugInfo){var d=F._debugInfo.grid,J=F._debugInfo.path,S=F.gv;d&&S.dm().remove(d),J&&S.dm().remove(J),F._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);