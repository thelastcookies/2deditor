!function(e,l){"use strict";var m=ht.AlarmSeverity=function(q,C,t,O,e){this.value=q,this.name=C,this.nickName=t,this.color=O,this.displayName=e};ht.Default.def("ht.AlarmSeverity",l,{toString:function(){return this.displayName||this.name}}),function(){m.severities=new ht.List,m._vm={},m._nm={},m._cp=function(z,Q){if(z&&Q){var p=z.value-Q.value;return p>0?1:0>p?-1:0}return z&&!Q?1:!z&&Q?-1:0},m.each=function(X,Y){m.severities.each(X,Y)},m.getSortFunction=function(){return m._cp},m.setSortFunction=function(V){m._cp=V,m.severities.sort(V)},m.add=function(k,N,z,X,P){var h=new m(k,N,z,X,P);return m._vm[k]=h,m._nm[N]=h,m.severities.add(h),m.severities.sort(m._cp),h},m.remove=function(g){var _=m._nm[g];return _&&(delete m._nm[g],delete m._vm[_.value],m.severities.remove(_)),_},m.CRITICAL=m.add(500,"Critical","C","#FF0000"),m.MAJOR=m.add(400,"Major","M","#FFA000"),m.MINOR=m.add(300,"Minor","m","#FFFF00"),m.WARNING=m.add(200,"Warning","W","#00FFFF"),m.INDETERMINATE=m.add(100,"Indeterminate","N","#C800FF"),m.CLEARED=m.add(0,"Cleared","R","#00FF00"),m.isClearedAlarmSeverity=function(s){return s?0===s.value:!1},m.getByName=function(T){return m._nm[T]},m.getByValue=function(d){return m._vm[d]},m.clear=function(){m.severities.clear(),m._vm={},m._nm={}},m.compare=function(H,g){return m._cp(H,g)}}();var f=ht.AlarmState=function(Y){this._d=Y,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",l,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var o=null;for(var s in this._am)s=m.getByName(s),m.isClearedAlarmSeverity(s)||0!==this.getAcknowledgedAlarmCount(s)&&(o=o?m.compare(o,s)>0?o:s:s);this._haa=o},_c2:function(){var G=null;for(var j in this._nm)j=m.getByName(j),m.isClearedAlarmSeverity(j)||0!==this.getNewAlarmCount(j)&&(G=G?m.compare(G,j)>0?G:j:j);this._hna=G},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var k in this._nm)if(k=m.getByName(k),!m.isClearedAlarmSeverity(k)&&0!==this.getNewAlarmCount(k)&&m.compare(this._hna,k)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var Y=this._haa,_=this._hna,n=this._ps;this._hoa=Y,m.compare(_,this._hoa)>0&&(this._hoa=_),m.compare(n,this._hoa)>0&&(this._hoa=n)},_c5:function(){var V=this._haa,X=this._hna;this._hta=V,m.compare(X,this._hta)>0&&(this._hta=X)},increaseAcknowledgedAlarm:function(L,T){if(0!==T){T=T||1;var M=this._am[L.name]||0;M+=T,this._am[L.name]=M,this._f()}},increaseNewAlarm:function(J,Z){if(0!==Z){Z=Z||1;var N=this._nm[J.name]||0;N+=Z,this._nm[J.name]=N,this._f()}},decreaseAcknowledgedAlarm:function(v,T){if(0!==T){T||(T=1);var V=this._am[v.name]||0;if(V-=T,0>V)throw"Alarm count can not be negative";this._am[v.name]=V,this._f()}},decreaseNewAlarm:function(R,S){if(0!==S){S||(S=1);var b=this._nm[R.name]||0;if(b-=S,0>b)throw"Alarm count can not be negative";this._nm[R.name]=b,this._f()}},acknowledgeAlarm:function(F){this.decreaseNewAlarm(F,1),this.increaseAcknowledgedAlarm(F,1)},acknowledgeAllAlarms:function(k){if(k){var L=this.getNewAlarmCount(k);this.decreaseNewAlarm(k,L),this.increaseAcknowledgedAlarm(k,L)}else for(var A in this._nm)this.acknowledgeAllAlarms(m.getByName(A))},_c6:function(){this._aac=0;for(var O in this._am)O=m.getByName(O),this._aac+=this.getAcknowledgedAlarmCount(O)},getAcknowledgedAlarmCount:function(x){return x?this._am[x.name]||0:this._aac},getAlarmCount:function(S){return this.getAcknowledgedAlarmCount(S)+this.getNewAlarmCount(S)},_c7:function(){this._nac=0;for(var E in this._nm)this._nac+=this.getNewAlarmCount(m.getByName(E))},getNewAlarmCount:function(m){return m?this._nm[m.name]||0:this._nac},setNewAlarmCount:function(Q,c){this._nm[Q.name]=c,this._f()},removeAllNewAlarms:function(h){h?delete this._nm[h]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,z){this._am[a.name]=z,this._f()},removeAllAcknowledgedAlarms:function(n){n?delete this._am[n.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(L){if(this._ep||(L=null),this._ps!==L){var I=this._ps;this._ps=L,this._f(),this._d.fp("propagateSeverity",I,L)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){var q=this._ep;this._ep=e,this._d.fp("enablePropagation",q,e)&&(e||this.setPropagateSeverity(null))}});var $=ht.AlarmStatePropagator=function(d){this._dataModel=d,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",l,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(X){this._enable!==X&&(this._enable=X,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(z){this.propagate(z)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(Y){Y.data&&this.propagate(Y.data)},handleDataPropertyChange:function(I){if("alarmState"===I.property||"enablePropagation"===I.property)this.propagate(I.data);else if("parent"===I.property){var u=I.oldValue;u&&this.propagate(u),this.propagate(I.data)}},propagate:function(Z){Z&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(Z),this._isPropagating=!1)},propagateToTop:function(z){for(this.propagateToParent(null,z);z&&z.getParent();)this.propagateToParent(z,z.getParent()),z=z.getParent()},propagateToParent:function(q,Y){var S=null;Y.getChildren().each(function(q){var X=q.getAlarmState().getHighestOverallAlarmSeverity();m.compare(X,S)>0&&(S=X)}),Y.getAlarmState().setPropagateSeverity(S)}}),ht.AlarmStateStatistics=function(I){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(I)},ht.Default.def("ht.AlarmStateStatistics",l,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(E){var P=this._dataModel;P!==E&&(P&&(P.umd(this.handleDataPropertyChange,this),P.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=E,this.reset(),E.md(this.handleDataPropertyChange,this),E.mm(this.handleDataModelChange,this),this.fp("dataModel",P,E))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(q){"alarmState"===q.property&&(this.increase(q.data),this.fireAlarmStateChange())},handleDataModelChange:function(k){"add"===k.kind?(this.increase(k.data),this.fireAlarmStateChange()):"remove"===k.kind?(this.decrease(k.data),this.fireAlarmStateChange()):"clear"===k.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,m.each(function(b){var D=this.getSumInfo(b);this.sumAcked+=D.ackedCount,this.sumNew+=D.newCount,this.sumTotal+=D.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(b){if(!b)return this.sumNew;var u=this.getSumInfo(b);return u.newCount},getAcknowledgedAlarmCount:function(x){if(!x)return this.sumAcked;var S=this.getSumInfo(x);return S.ackedCount},getTotalAlarmCount:function(J){if(!J)return this.sumTotal;var D=this.getSumInfo(J);return D.totalCount},getSumInfo:function(c){var q=this.severtiyMap[c.name];return q||(q={},q.newCount=0,q.ackedCount=0,q.totalCount=0,this.severtiyMap[c.name]=q),q},decrease:function(i){var n=this.dataMap[i.getId()];n&&(delete this.dataMap[i.getId()],m.each(function(U){var $=n[U.name],R=this.getSumInfo(U);R.newCount=R.newCount-$.newCount,R.ackedCount=R.ackedCount-$.ackedCount,R.totalCount=R.totalCount-$.totalCount},this))},increase:function(h){if(this.decrease(h),!this._filterFunc||this._filterFunc(h)){var J={},n=h.getAlarmState();this.dataMap[h.getId()]=J,m.each(function(Z){var g={};g.newCount=n.getNewAlarmCount(Z),g.ackedCount=n.getAcknowledgedAlarmCount(Z),g.totalCount=n.getAlarmCount(Z),J[Z.name]=g;var h=this.getSumInfo(Z);h.newCount=h.newCount+g.newCount,h.ackedCount=h.ackedCount+g.ackedCount,h.totalCount=h.totalCount+g.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(u){var q=this._filterFunc;this._filterFunc=u,this.reset(),this.fp("filterFunc",q,u)},getFilterFunc:function(){return this._filterFunc}});var Z=ht.Data.prototype;Z.getAlarmState=function(){return this._alarmState||(this._alarmState=new f(this))},Z=ht.DataModel.prototype,Z.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},Z.setEnableAlarmStatePropagator=function(D){D!=this.isEnableAlarmStatePropagator()&&(D?(this._alarmStatePropagator=new $(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},Z=ht.graph.GraphView.prototype,Z.getNote2=function(J){var n=J.getAlarmState().getHighestNewAlarmSeverity();if(n){var T=J.getAlarmState().getNewAlarmCount(n)+n.nickName;return J.getAlarmState().hasLessSevereNewAlarms()&&(T+="+"),T}return J.s("note2")},Z.getNote2Background=function(j){var w=j.getAlarmState().getHighestNewAlarmSeverity();return w?w.color:j.s("note2.background")},Z.getBodyColor=function(y){var G=y.getAlarmState().getHighestNativeAlarmSeverity();return G?G.color:y.s("body.color")},Z.getBorderColor=function(c){var W=c.getAlarmState().getPropagateSeverity();return W?W.color:c.s("border.color")},Z=ht.widget.TreeView.prototype,Z.getBorderColor=function(U){var l=U.getAlarmState().getPropagateSeverity();return l?l.color:U.s("border.color")},Z.getIcon=function(b){return b.getIcon()?"__alarmIcon__":null},Z=ht.widget.TreeTableView.prototype,Z.getBorderColor=function(m){var k=m.getAlarmState().getPropagateSeverity();return k?k.color:m.s("border.color")},Z.getIcon=function(X){return X.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(N){return N.getIcon()}},color:{func:function(s){var D=s.getAlarmState().getHighestNativeAlarmSeverity();return D?D.color:s.s("body.color")}},rect:[0,0,16,16]}]});var Y=ht.Style;Y["note2.expanded"]=!0,Y["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);