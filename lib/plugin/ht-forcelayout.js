!function(h,o){"use strict";var k="ht",m=k+".layout.",t=h[k]||module.parent.exports.ht,L=t.List,c=t.DataModel,f=t.Node,i=t.Edge,Z=t.Group,x=Math,O=x.sqrt,C=x.random,J=x.max,p=x.min,U=function(e){return e*e};t.Default.getInternal().addMSMap({ms_force:function(F){F._interval=50,F._stepCount=10,F._motionLimit=.01,F._edgeRepulsion=.65,F._nodeRepulsion=.65,F._damper=1,F._maxMotion=0,F._motionRatio=0,F.init=function(v){var S=this;v instanceof c?S.dm=v:S.gv=v,S._nodeMap={},S._nodes=new L,S._edges=new L},F.start=function(){var w=this,g=w.gv;if(!w._timer){var N=w.cdm=g?g.dm():w.dm;N.mm(w.handleDataModelChange,w),N.md(w.handleDataPropertyChange,w),g&&g.mp(w.handleGV,w),N.each(function(V){if(w.isVisible(V)&&w.isLayoutable(V)&&V instanceof f)if(w instanceof n){var b=V.p3();V.p3([b[0]+C(),b[1]+C(),b[2]+C()])}else b=V.p(),V.p(b.x+C(),b.y+C())}),w._timer=setInterval(function(){w.relax()},w._interval),w._damper=1}},F.stop=function(){var I=this;I._timer&&(I.cdm.umm(I.handleDataModelChange,I),I.cdm.umd(I.handleDataPropertyChange,I),I.gv&&I.gv.ump(I.handleGV,I),clearInterval(I._timer),delete I._timer,delete I.cdm)},F.handleGV=function(H){var g=this;if("dataModel"===H.property){var d=H.oldValue,b=H.newValue;d&&(d.umm(g.handleDataModelChange,g),d.umd(g.handleDataPropertyChange,g)),this.cdm=b,b.mm(g.handleDataModelChange,g),b.md(g.handleDataPropertyChange,g)}},F.relax=function(){var h=this;if(!(h._damper<.1&&h._maxMotion<h._motionLimit)){this.cdm.each(function(G){h.isVisible(G)&&(G instanceof i?h.addEdge(G):G instanceof f&&h.addNode(G))});for(var P,W,K=0,s=h._edges,A=h._nodes,z=A.size();K<h._stepCount;K++){for(s.each(h.relaxEdge,h),P=0;z>P;P++)for(W=0;z>W;W++)h.relaxNode(A.get(P),A.get(W));h.moveNode()}h._isAdjusting=1,A.each(function(y){y.fix||(y.p?y.v.p3(y.p):y.v.p(y.x,y.y))}),delete h._isAdjusting,h._nodeMap={},A.clear(),s.clear(),h.onRelaxed()}},F.onRelaxed=function(){},F.isRunning=function(){return!!this._timer},F.isVisible=function(T){return T.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(T):!0},F.isLayoutable=function(B){if(B.s("layoutable")===!1)return!1;if(B instanceof Z)return!1;var b=this;return b.gv?b.gv.isMovable(B)&&!b.gv.isSelected(B):!(b.cdm||b.dm).sm().co(B)},F.getNodeRepulsion=function(){return this._nodeRepulsion},F.setNodeRepulsion=function(g){this._nodeRepulsion=g,this._damper=1},F.getEdgeRepulsion=function(){return this._edgeRepulsion},F.setEdgeRepulsion=function(q){this._edgeRepulsion=q,this._damper=1},F.getStepCount=function(){return this._stepCount},F.setStepCount=function(Q){this._stepCount=Q,this._damper=1},F.getInterval=function(){return this._interval},F.setInterval=function(t){var T=this;T._interval!==t&&(T._interval=t,T._timer&&(clearInterval(T._timer),T._timer=setInterval(function(){T.relax()},t)))},F.handleDataPropertyChange=function(Y){!this._isAdjusting&&this.isVisible(Y.data)&&(this._damper=1)},F.handleDataModelChange=function(){this._damper=1},F.damp=function(){var $=this._maxMotion,Q=this._damper;this._motionRatio<=.001&&((.2>$||$>1&&.9>Q)&&Q>.01?this._damper-=.01:.4>$&&Q>.003?this._damper-=.003:Q>1e-4&&(this._damper-=1e-4)),$<this._motionLimit&&(this._damper=0)}}}),t.layout.ForceLayout=function(H){this.init(H)},t.Default.def(m+"ForceLayout",o,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(D){this._limitBounds=D,this._damper=1},getNodeSize:function(l){var c=this.gv;return c&&c.getDataUIBounds?c.getDataUIBounds(l):l.getRect()},addNode:function(y){var j=this,l=j._nodeMap[y._id];if(l)return l;var s=y.p();l={v:y,x:s.x,y:s.y,dx:0,dy:0,fix:!j.isLayoutable(y),s:j.getNodeSize(y)};var J=l.s,r=O(U(J.width)+U(J.height))*j._nodeRepulsion;return l.r=1>r?100:r,j._nodeMap[y._id]=l,j._nodes.add(l),l},addEdge:function(L){if(L._40I&&L._41I){var y=this,J=y.addNode(L._40I),q=y.addNode(L._41I),R={s:J,t:q};q=q.s,J=J.s;var D=q.width+J.width,e=q.height+J.height;R.length=O(D*D+e*e)*y._edgeRepulsion,R.length<=0&&(R.length=100),y._edges.add(R)}},relaxEdge:function(p){var B=p.t,x=p.s,m=B.x-x.x,r=B.y-x.y,t=O(m*m+r*r),k=100*p.length,J=.25*m/k*t,a=.25*r/k*t;B.dx=B.dx-J,B.dy=B.dy-a,x.dx=x.dx+J,x.dy=x.dy+a},relaxNode:function(Z,L){if(Z!==L){var b=0,X=0,t=Z.x-L.x,e=Z.y-L.y,z=t*t+e*e;0===z?(b=C(),X=C()):36e4>z&&(b=t/z,X=e/z);var E=Z.r*L.r/400;b*=E,X*=E,Z.dx+=b,Z.dy+=X,L.dx-=b,L.dy-=X}},moveNode:function(){var $=this,n=$._limitBounds,s=$._maxMotion,b=0,Q=$._damper;$._nodes.each(function(r){if(!r.fix){var e=r.dx*Q,h=r.dy*Q;if(r.dx=e/2,r.dy=h/2,b=J(O(e*e+h*h),b),r.x+=J(-40,p(40,e)),r.y+=J(-40,p(40,h)),n){r.x<n.x&&(r.x=n.x,$.adjust(1,0)),r.y<n.y&&(r.y=n.y,$.adjust(0,1));var c=r.s;r.x+c.width>n.x+n.width&&(r.x=n.x+n.width-c.width,$.adjust(-1,0)),r.y+c.height>n.y+n.height&&(r.y=n.y+n.height-c.height,$.adjust(0,-1))}}}),$._maxMotion=b,$._motionRatio=b>0?s/b-1:0,$.damp()},adjust:function(x,n){var G=this._limitBounds;this._nodes.each(function(a){x>0?(!G||a.x+a.s.width+x<G.x+G.width)&&(a.x+=x):(!G||a.x+x>G.x)&&(a.x+=x),n>0?(!G||a.y+a.s.height+n<G.y+G.height)&&(a.y+=n):(!G||a.y+n>G.y)&&(a.y+=n)})}});var n=t.layout.Force3dLayout=function(J){this.init(J)};t.Default.def(m+"Force3dLayout",o,{ms_force:1,getNodeSize3d:function(y){return y.s3()},addNode:function(i){var n=this,O=n._nodeMap[i._id];if(O)return O;O={v:i,p:i.p3(),d:[0,0,0],fix:!n.isLayoutable(i),s:n.getNodeSize3d(i)};var I=O.s,K=t.Default.getDistance(I)*n._nodeRepulsion;return O.r=1>K?100:K,n._nodeMap[i._id]=O,n._nodes.add(O),O},addEdge:function($){if($._40I&&$._41I){var X=this,g=X.addNode($._40I),P=X.addNode($._41I),D={s:g,t:P};P=P.s,g=g.s,D.length=O(U(P[0]+g[0])+U(P[1]+g[1])+U(P[2]+g[2]))*X._edgeRepulsion,D.length<=0&&(D.length=100),X._edges.add(D)}},relaxEdge:function(n){var V=n.t.p,W=n.s.p,b=n.t.d,Y=n.s.d,k=V[0]-W[0],L=V[1]-W[1],N=V[2]-W[2],T=O(k*k+L*L+N*N),i=100*n.length,r=.25*k/i*T,J=.25*L/i*T,x=.25*N/i*T;b[0]-=r,b[1]-=J,b[2]-=x,Y[0]+=r,Y[1]+=J,Y[2]+=x},relaxNode:function(c,_){if(c!==_){var l=c.p,g=_.p,s=0,E=0,f=0,u=l[0]-g[0],h=l[1]-g[1],T=l[2]-g[2],q=u*u+h*h+T*T;0===q?(s=C(),E=C(),f=C()):216e6>q&&(s=u/q,E=h/q,f=T/q);var b=c.r*_.r/400,e=c.d,z=_.d;s*=b,E*=b,f*=b,e[0]+=s,e[1]+=E,e[2]+=f,z[0]-=s,z[1]-=E,z[2]-=f}},moveNode:function(){var X=this,d=X._maxMotion,P=0,e=X._damper;X._nodes.each(function(j){if(!j.fix){var $=j.p,s=j.d,S=s[0]*e,K=s[1]*e,l=s[2]*e;s[0]=S/2,s[1]=K/2,s[2]=l/2,P=J(O(S*S+K*K+l*l),P),$[0]+=J(-40,p(40,S)),$[1]+=J(-40,p(40,K)),$[2]+=J(-40,p(40,l))}}),X._maxMotion=P,X._motionRatio=P>0?d/P-1:0,X.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);