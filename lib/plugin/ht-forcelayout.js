!function(m,V){"use strict";var s="ht",y=s+".layout.",w=m[s]||module.parent.exports.ht,O=w.List,t=w.DataModel,g=w.Node,U=w.Edge,x=w.Group,q=Math,S=q.sqrt,r=q.random,v=q.max,K=q.min,z=function(s){return s*s};w.Default.getInternal().addMSMap({ms_force:function(z){z._interval=50,z._stepCount=10,z._motionLimit=.01,z._edgeRepulsion=.65,z._nodeRepulsion=.65,z._damper=1,z._maxMotion=0,z._motionRatio=0,z.init=function(b){var U=this;b instanceof t?U.dm=b:U.gv=b,U._nodeMap={},U._nodes=new O,U._edges=new O},z.start=function(){var A=this,M=A.gv;if(!A._timer){var w=A.cdm=M?M.dm():A.dm;w.mm(A.handleDataModelChange,A),w.md(A.handleDataPropertyChange,A),M&&M.mp(A.handleGV,A),w.each(function(I){if(A.isVisible(I)&&A.isLayoutable(I)&&I instanceof g)if(A instanceof T){var R=I.p3();I.p3([R[0]+r(),R[1]+r(),R[2]+r()])}else R=I.p(),I.p(R.x+r(),R.y+r())}),A._timer=setInterval(function(){A.relax()},A._interval),A._damper=1}},z.stop=function(){var y=this;y._timer&&(y.cdm.umm(y.handleDataModelChange,y),y.cdm.umd(y.handleDataPropertyChange,y),y.gv&&y.gv.ump(y.handleGV,y),clearInterval(y._timer),delete y._timer,delete y.cdm)},z.handleGV=function(y){var c=this;if("dataModel"===y.property){var Q=y.oldValue,j=y.newValue;Q&&(Q.umm(c.handleDataModelChange,c),Q.umd(c.handleDataPropertyChange,c)),this.cdm=j,j.mm(c.handleDataModelChange,c),j.md(c.handleDataPropertyChange,c)}},z.relax=function(){var N=this;if(!(N._damper<.1&&N._maxMotion<N._motionLimit)){this.cdm.each(function(M){N.isVisible(M)&&(M instanceof U?N.addEdge(M):M instanceof g&&N.addNode(M))});for(var v,X,L=0,n=N._edges,I=N._nodes,A=I.size();L<N._stepCount;L++){for(n.each(N.relaxEdge,N),v=0;A>v;v++)for(X=0;A>X;X++)N.relaxNode(I.get(v),I.get(X));N.moveNode()}N._isAdjusting=1,I.each(function(O){O.fix||(O.p?O.v.p3(O.p):O.v.p(O.x,O.y))}),delete N._isAdjusting,N._nodeMap={},I.clear(),n.clear(),N.onRelaxed()}},z.onRelaxed=function(){},z.isRunning=function(){return!!this._timer},z.isVisible=function(u){return u.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(u):!0},z.isLayoutable=function(B){if(B.s("layoutable")===!1)return!1;if(B instanceof x)return!1;var Z=this;return Z.gv?Z.gv.isMovable(B)&&!Z.gv.isSelected(B):!(Z.cdm||Z.dm).sm().co(B)},z.getNodeRepulsion=function(){return this._nodeRepulsion},z.setNodeRepulsion=function(H){this._nodeRepulsion=H,this._damper=1},z.getEdgeRepulsion=function(){return this._edgeRepulsion},z.setEdgeRepulsion=function(K){this._edgeRepulsion=K,this._damper=1},z.getStepCount=function(){return this._stepCount},z.setStepCount=function(W){this._stepCount=W,this._damper=1},z.getInterval=function(){return this._interval},z.setInterval=function(Q){var I=this;I._interval!==Q&&(I._interval=Q,I._timer&&(clearInterval(I._timer),I._timer=setInterval(function(){I.relax()},Q)))},z.handleDataPropertyChange=function(r){!this._isAdjusting&&this.isVisible(r.data)&&(this._damper=1)},z.handleDataModelChange=function(){this._damper=1},z.damp=function(){var K=this._maxMotion,R=this._damper;this._motionRatio<=.001&&((.2>K||K>1&&.9>R)&&R>.01?this._damper-=.01:.4>K&&R>.003?this._damper-=.003:R>1e-4&&(this._damper-=1e-4)),K<this._motionLimit&&(this._damper=0)}}}),w.layout.ForceLayout=function(M){this.init(M)},w.Default.def(y+"ForceLayout",V,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(p){this._limitBounds=p,this._damper=1},getNodeSize:function(L){var t=this.gv;return t&&t.getDataUIBounds?t.getDataUIBounds(L):L.getRect()},addNode:function(C){var q=this,c=q._nodeMap[C._id];if(c)return c;var f=C.p();c={v:C,x:f.x,y:f.y,dx:0,dy:0,fix:!q.isLayoutable(C),s:q.getNodeSize(C)};var I=c.s,P=S(z(I.width)+z(I.height))*q._nodeRepulsion;return c.r=1>P?100:P,q._nodeMap[C._id]=c,q._nodes.add(c),c},addEdge:function(h){if(h._40I&&h._41I){var R=this,Z=R.addNode(h._40I),x=R.addNode(h._41I),N={s:Z,t:x};x=x.s,Z=Z.s;var e=x.width+Z.width,H=x.height+Z.height;N.length=S(e*e+H*H)*R._edgeRepulsion,N.length<=0&&(N.length=100),R._edges.add(N)}},relaxEdge:function(t){var _=t.t,o=t.s,m=_.x-o.x,O=_.y-o.y,W=S(m*m+O*O),B=100*t.length,M=.25*m/B*W,J=.25*O/B*W;_.dx=_.dx-M,_.dy=_.dy-J,o.dx=o.dx+M,o.dy=o.dy+J},relaxNode:function(A,g){if(A!==g){var n=0,p=0,B=A.x-g.x,P=A.y-g.y,Q=B*B+P*P;0===Q?(n=r(),p=r()):36e4>Q&&(n=B/Q,p=P/Q);var q=A.r*g.r/400;n*=q,p*=q,A.dx+=n,A.dy+=p,g.dx-=n,g.dy-=p}},moveNode:function(){var x=this,C=x._limitBounds,J=x._maxMotion,G=0,I=x._damper;x._nodes.each(function(g){if(!g.fix){var X=g.dx*I,w=g.dy*I;if(g.dx=X/2,g.dy=w/2,G=v(S(X*X+w*w),G),g.x+=v(-40,K(40,X)),g.y+=v(-40,K(40,w)),C){g.x<C.x&&(g.x=C.x,x.adjust(1,0)),g.y<C.y&&(g.y=C.y,x.adjust(0,1));var T=g.s;g.x+T.width>C.x+C.width&&(g.x=C.x+C.width-T.width,x.adjust(-1,0)),g.y+T.height>C.y+C.height&&(g.y=C.y+C.height-T.height,x.adjust(0,-1))}}}),x._maxMotion=G,x._motionRatio=G>0?J/G-1:0,x.damp()},adjust:function(t,M){var y=this._limitBounds;this._nodes.each(function(r){t>0?(!y||r.x+r.s.width+t<y.x+y.width)&&(r.x+=t):(!y||r.x+t>y.x)&&(r.x+=t),M>0?(!y||r.y+r.s.height+M<y.y+y.height)&&(r.y+=M):(!y||r.y+M>y.y)&&(r.y+=M)})}});var T=w.layout.Force3dLayout=function(E){this.init(E)};w.Default.def(y+"Force3dLayout",V,{ms_force:1,getNodeSize3d:function(n){return n.s3()},addNode:function(a){var f=this,x=f._nodeMap[a._id];if(x)return x;x={v:a,p:a.p3(),d:[0,0,0],fix:!f.isLayoutable(a),s:f.getNodeSize3d(a)};var G=x.s,H=w.Default.getDistance(G)*f._nodeRepulsion;return x.r=1>H?100:H,f._nodeMap[a._id]=x,f._nodes.add(x),x},addEdge:function(p){if(p._40I&&p._41I){var A=this,C=A.addNode(p._40I),P=A.addNode(p._41I),o={s:C,t:P};P=P.s,C=C.s,o.length=S(z(P[0]+C[0])+z(P[1]+C[1])+z(P[2]+C[2]))*A._edgeRepulsion,o.length<=0&&(o.length=100),A._edges.add(o)}},relaxEdge:function(i){var t=i.t.p,W=i.s.p,Q=i.t.d,A=i.s.d,g=t[0]-W[0],y=t[1]-W[1],G=t[2]-W[2],R=S(g*g+y*y+G*G),w=100*i.length,O=.25*g/w*R,o=.25*y/w*R,U=.25*G/w*R;Q[0]-=O,Q[1]-=o,Q[2]-=U,A[0]+=O,A[1]+=o,A[2]+=U},relaxNode:function(B,L){if(B!==L){var s=B.p,d=L.p,X=0,u=0,q=0,f=s[0]-d[0],n=s[1]-d[1],c=s[2]-d[2],Q=f*f+n*n+c*c;0===Q?(X=r(),u=r(),q=r()):216e6>Q&&(X=f/Q,u=n/Q,q=c/Q);var K=B.r*L.r/400,$=B.d,Y=L.d;X*=K,u*=K,q*=K,$[0]+=X,$[1]+=u,$[2]+=q,Y[0]-=X,Y[1]-=u,Y[2]-=q}},moveNode:function(){var H=this,D=H._maxMotion,Y=0,o=H._damper;H._nodes.each(function(I){if(!I.fix){var x=I.p,$=I.d,V=$[0]*o,n=$[1]*o,A=$[2]*o;$[0]=V/2,$[1]=n/2,$[2]=A/2,Y=v(S(V*V+n*n+A*A),Y),x[0]+=v(-40,K(40,V)),x[1]+=v(-40,K(40,n)),x[2]+=v(-40,K(40,A))}}),H._maxMotion=Y,H._motionRatio=Y>0?D/Y-1:0,H.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);