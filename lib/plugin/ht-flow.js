!function(E){"use strict";var Z=E.ht,z=Z.Default,j=z.getInternal(),q=j.ui(),T=null,L="__segmentLengths",D="__lineTotalLength",g="__linePoints",K="__distance0",W="flow.count",k="flow.step",l="flow.element.max",a="flow.element.count",U="flow.element.min",S="flow.element.space",G="flow.element.autorotate",V="flow.element.background",Q="flow.element.shadow.max",n="flow.element.shadow.min",y="flow.element.shadow.begincolor",A="flow.element.shadow.endcolor",e="flow.element.shadow.visible",I="flow.element.image",d="flow",o=Z.Math.Vector2,J=new o;new o,new o,Z.List;var p=Z.Default._edgeProtectMethod,f=p.getStraightLinePoints,m=function(h,T){for(var b=[],Z=h.length,R=0;Z>R;R++){var g=h[R];g._as&&(g=g._as);for(var p=g[0],W=1;W<g.length;W++)b.push([p,g[W]]),p=g[W]}for(var d=[],R=0;R<b.length;R++){var D=v(b[R][0],b[R][1],T);d.push(D)}return{distance:d,segments:b}},O=function(L,X,S){if(L){for(var y,p=m(L,X),k=p.distance,T=p.segments,W=1/0,O=null,C=0,d=k.length;d>C;C++){var H=k[C];H.z<W&&(y=C,W=H.z,O=H)}if(null==S&&(S=.1),O.z<S){for(var D=0,w=0;y>=w;w++)D+=z.getDistance(T[w][0],y>w?T[w][1]:O);return D}}},v=function(E,r,X){var B=E.x,e=E.y,f=r.x,C=r.y,t=X.x,m=X.y,z=f-B,h=C-e,v=Math.sqrt(z*z+h*h),R=z/v,V=h/v,i=(-B+t)*R+(-e+m)*V,H={x:B+i*R,y:e+i*V};return H.x>=Math.min(E.x,r.x)&&H.x<=Math.max(E.x,r.x)&&H.y>=Math.min(E.y,r.y)&&H.y<=Math.max(E.y,r.y)||(H.x=Math.abs(H.x-E.x)<Math.abs(H.x-r.x)?E.x:r.x,H.y=Math.abs(H.y-E.y)<Math.abs(H.y-r.y)?E.y:r.y),z=t-H.x,h=m-H.y,H.z=Math.sqrt(z*z+h*h),H},c=function(v,k){if(v){var $=m(v,k).distance,B=1/0,f=null;return $.forEach(function(N){N.z<B&&(B=N.z,f=N)}),f}},P=p.calculateLineLength,s=p.calcSegmentIndexByDistance,$=p.calculatePointAlongLine,C=function(r,v,Z){if(!r)return Z;if(0===v){var p=r[0][0],F=r[0][1];return Z+Math.atan2(F.y-p.y,F.x-p.x)}if(100===v){r=r[r.length-1];var p=r[r.length-2],F=r[r.length-1];return Z+Math.atan2(F.y-p.y,F.x-p.x)}for(var G=0,h=[],C=r.length,d=0;C>d;d++){var u=r[d],i=P(u);G+=i,h.push(i)}for(var R=G*v/100,x=s(R,h),K=0,H=0;x>H;H++)K+=h[H];R-=K;for(var k=$(r[x],R),l=r[x],w=0,L=0,J=0;J<l.length-1;J++){var X=l[J],e=l[J+1],q=e.x-X.x,g=e.y-X.y,B=Math.sqrt(q*q+g*g);if(w+=B,w>R){L=J;break}}var Q=l[L];return Z+Math.atan2(k.y-Q.y,k.x-Q.x)},M=function(v){var b=0;if(v)if(Array.isArray(v[0]))for(var g=v.length,c=0;g>c;c++){var G=v[c],M=P(G);b+=M}else b=P(v);return b},b=function(F,g,H,c){return J.set(g,H).rotateAround(null,c),F?{x:F.x+J.x,y:F.y+J.y}:{x:J.x,y:J.y}},w=function(B){var y=B._data,i=f(B);if(i){y.s("flow.reverse")&&(i.reverse(),i.forEach(function(O){O.reverse()}));for(var c=0,S=[],V=i.length,_=0;V>_;_++){var U=i[_],H=P(U);c+=H,S.push(H)}if(y[L]=S,y[D]=c,y[g]=i,y instanceof Z.Edge){var E=z.unionPoint(i),$=E.x+E.width/2,w=E.y+E.height/2;y.$10e={x:$,y:w}}N(B,!0)}},B=p.getPercentPosition,N=function(p,O){var h=p._data,Y=h[D],u=h.s(W),v=h.s(k),j=0,J=h[L],c=h.s(l),S=h.s(U),H=h.s(a),i=(c-S)/(H-1),N=[];if(J){if(1===H)N.push(c);else if(2===H)N.push(c),N.push(S);else{if(!(H>2))return;N.push(c);for(var y=H-2;y>0;y--)N.push(S+i*y);N.push(S)}var Q=0,G=0;N.forEach(function(x){H-1>Q&&(G+=h.getFlowElementSpace(x)),Q++}),G+=(c+S)/2,j=(Y-u*G+G)/u;var E=p[K];for(null==E&&(E=0),O||(E+=v);E>Y+G;){var V=p._overCount;V?V++:V=1,V>=u&&(V=null),p._overCount=V,h.s("flow.autoreverse")?V?E-=j+G:(E=0,h.s("flow.reverse",!h.s("flow.reverse"))):E-=j+G}p[K]=E}},F="prototype",X=Z.graph.GraphView[F],t=Z.Data[F],_=q.DataUI[F],r=q.ShapeUI[F],R=q.EdgeUI[F],h=Z.DataModel[F],u=Z.Style;u[l]==T&&(u[l]=7),u[U]==T&&(u[U]=0),u[W]==T&&(u[W]=1),u[k]==T&&(u[k]=3),u[a]==T&&(u[a]=10),u[S]==T&&(u[S]=3.5),u[G]==T&&(u[G]=!1),u[V]==T&&(u[V]="rgba(255, 255, 114, 0.4)"),u[y]==T&&(u[y]="rgba(255, 255, 0, 0.3)"),u[A]==T&&(u[A]="rgba(255, 255, 0, 0)"),u[e]==T&&(u[e]=1),u[Q]==T&&(u[Q]=22),u[n]==T&&(u[n]=4),X.calculatePointLength=function(g,y,v){var J=this.getDataUI(g),Z=f(J);return O(Z,y,v)},z.calculatePointLength=function(c,X,Z,M){var r=f(T,c,X);return O(r,Z,M)},z.calculateClosestPointOnLine=v,X.calculateClosestPoint=function(y,w){var h=this.getDataUI(y),N=f(h);return c(N,w)},z.calculateClosestPoint=function(_,y,B){var l=f(T,_,y);return c(l,B)},X.getPercentAngle=function(g,S){var k=this.getDataUI(g),y=f(k);return g.getRotation?g.getRotation():0,C(y,S,g.getRotation?g.getRotation():0)},z.getPercentAngle=function(D,a,h){var o=f(T,D,a);return C(o,h,0)},X.calculateLength=function(p){var h=this.getDataUI(p),g=f(h);return M(g)},z.calculateLength=function(V,S){var b=f(T,V,S);return M(b)},X.getPercentPosition=function(w,y){var h=this.getDataUI(w),v=f(h);return B(v,y)},z.getPercentPositionOnPoints=function(u,p,F){var S=f(T,u,p);return B(S,F)};var Y=function(g){var s=g.data,N=this.dm();if(s&&"add"===g.kind){var c=N.$3e;c&&s.s(d)&&c.indexOf(s)<0&&c.push(s)}"clear"===g.kind&&(N.$3e=[])},H=function(e){var W=e.property,J=e.data,o=e.newValue,K=this.dm().$3e;if(K&&"s:flow"===W)if(o)K.indexOf(J)<0&&K.push(J);else for(var j=K.length,P=0;j>P;P++)if(K[P]===J){K.splice(P,1);break}},i=X.setDataModel;X.setDataModel=function(R){var l=this,X=l._dataModel;if(X!==R){X&&(X.umm(Y,l),X.umd(H,l),X.$3e=[]),R.mm(Y,l),R.md(H,l);var x=R.$3e=[];R.each(function(o){o.s(d)&&x.indexOf(o)<0&&x.push(o)}),i.call(l,R)}},t.getFlowElementSpace=function(){return this.s(S)};var x=function(S){var p=this,w=p._data,P=w[D],h=w[L],B=w[g],F=w.s(W),i=0,c=p[K],o=w.s(l),f=w.s(U),J=w.s(a),k=w.s(n),y=w.s(Q),Y=w.s(G),q=(y-k)/(J-1),O=(o-f)/(J-1),v=w.getRotation?w.getRotation():0,z=w.getPosition?w.p():w.$10e,E=[],r=[];if(c!=T){if(1===J)E.push(o);else if(2===J)E.push(o),E.push(f);else{if(!(J>2))return;E.push(o);for(var x=J-2;x>0;x--)E.push(f+O*x);E.push(f)}if(1===J)r.push(y);else if(2===J)r.push(y),r.push(k);else{if(!(J>2))return;r.push(y);for(var x=J-2;x>0;x--)r.push(k+q*x);r.push(k)}var m=0,H=0;E.forEach(function(Z){J-1>m&&(H+=w.getFlowElementSpace(Z)),m++}),H+=(o+f)/2,i=(P-F*H+H)/F,S.save();for(var x=0;F>x;x++){var j=c,R=0,Z=p._overCount,X=0;w.s("flow.autoreverse")&&Z&&Z>F-(x+1)||(j-=x*(i+H),m=0,E.forEach(function(K){var Q=j-R;if(Q>=0&&P>Q){var M=!0,W=s(Q,h);X=0;for(var C=0;W>C;C++)X+=h[C];if(Q-=X,M){var A=$(B[W],Q),a=v;if(Y){for(var f=B[W],l=0,x=0,c=0;c<f.length-1;c++){var i=f[c],D=f[c+1],t=D.x-i.x,U=D.y-i.y,e=Math.sqrt(t*t+U*U);if(l+=e,l>Q){x=c;break}}var d=f[x];a+=Math.atan2(A.y-d.y,A.x-d.x)}v&&(A=b(z,A.x-z.x,A.y-z.y,v)),p.$5e(S,A,K,r[m],a)}}R+=w.getFlowElementSpace(E[m]),m++}))}S.restore()}},_i=R._80o;R._80o=function(E){_i.call(this,E);var t=this,p=t._data,g=t.gv;p.s(d)&&g.$7e!=T&&x.call(t,E)};var Ub=r._80o;r._80o=function(a){Ub.call(this,a);var n=this,J=n._data,r=n.gv;J.s(d)&&r.$7e!=T&&x.call(n,a)};var Mr=R._79o,Yp=r._79o,vh=function(){var m=this,n=m._data,H=n.s(l),q=!1,s=T;if(m._6I||(q=!0),s=n instanceof Z.Edge?Mr.call(m):Yp.call(m),n.s(d)&&q){var J=n.s(Q),B=n.s(e);B&&J>H&&(H=J),H>0&&z.grow(s,Math.ceil(H/2)),w(m)}return!n.s(d)&&q&&(n[L]=n[D]=n[g]=m[K]=T),s};r._79o=vh,R._79o=vh,_.$5e=function(r,W,m,i,H){var h=this,Q=h._data,q=h.gv,C=Q.s(V),_=Q.s(y),b=Q.s(A),Z=Q.s(e),K=q.$8e,u=Q.s(I);if(K==T&&(K=q.$8e={}),r.beginPath(),u!=T){var c=z.getImage(u),O=m/2;r.translate(W.x,W.y),r.rotate(H),r.translate(-W.x,-W.y),z.drawImage(r,c,W.x-O,W.y-O,m,m,Q),r.translate(W.x,W.y),r.rotate(-H),r.translate(-W.x,-W.y)}else if(q.__flowBatch){var l=q.__flowBatchGroup;l||(l=q.__flowBatchGroup={});var D=[W.x,W.y,m/2];l[C]?l[C].push(D):l[C]=[D]}else r.fillStyle=C,r.arc(W.x,W.y,m/2,0,2*Math.PI,!0),r.fill();if(Z){var B=22,E=B+"_"+_+"_"+b,s=K[E];if(s==T){var p=document.createElement("canvas");j.setCanvas(p,B,B);var F=p.getContext("2d"),N=B/2,Y=N,t=N;j.translateAndScale(F,0,0,1),F.beginPath();var S=F.createRadialGradient(Y,t,0,Y,Y,N);S.addColorStop(0,_),S.addColorStop(1,b),F.fillStyle=S,F.arc(Y,t,N,0,2*Math.PI,!0),F.fill(),s=K[E]=p}var O=i/2;z.drawImage(r,s,W.x-O,W.y-O,i,i,Q)}},X.$9e=function(){var T=this,n=T.dm().$3e;T._24I,n.forEach(function(Y){T._24I[Y._id]=Y}),T.iv()};var us=h.prepareRemove;h.prepareRemove=function(B){us.call(this,B);var E=B._dataModel,Y=E.$3e;if(Y)for(var q=Y.length,S=0;q>S;S++)if(Y[S]===B){Y.splice(S,1);break}},X.setFlowInterval=function(w){var q=this,Y=q.$11e;q.$11e=w,q.fp("flowInterval",Y,w),q.$7e!=T&&(clearInterval(q.$7e),delete q.$7e,q.enableFlow(w))},X.getFlowInterval=function(){return this.$11e},X.enableFlow=function(B){var Z=this,i=Z.dm(),S=i.$3e;Z.$7e==T&&(S.forEach(function(r){var J=Z.getDataUI(r);w(J)}),Z.$7e=setInterval(function(){i.$3e.forEach(function(A){N(Z.getDataUI(A))}),Z.$9e()},B||Z.$11e||50))},X.disableFlow=function(){var i=this;clearInterval(i.$7e),delete i.$7e;var e=i.dm().$3e;e&&i.$9e()};var Sr=function(){this.__flowBatchGroup={}},gq=function(q){var G=this.__flowBatchGroup;if(G){q.save();for(var c in G){q.fillStyle=c,q.beginPath();var A=G[c];A.forEach(function(V){q.moveTo(V[0],V[1]),q.arc(V[0],V[1],V[2],0,2*Math.PI,!0)}),q.fill()}q.restore()}};X.setFlowBatch=function(z){var f=this;!!f.__flowBatch!=!!z&&(f.__flowBatch=z,z?(f.addBottomPainter(Sr),f.addTopPainter(gq)):(f.removeBottomPainter(Sr),f.removeTopPainter(gq)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);