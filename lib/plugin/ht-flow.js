!function(R){"use strict";var e=R.ht,c=e.Default,Q=c.getInternal(),v=Q.ui(),D=null,N="__segmentLengths",u="__lineTotalLength",O="__linePoints",U="__distance0",g="flow.count",I="flow.step",Z="flow.element.max",X="flow.element.count",h="flow.element.min",M="flow.element.space",C="flow.element.autorotate",E="flow.element.background",F="flow.element.shadow.max",L="flow.element.shadow.min",S="flow.element.shadow.begincolor",H="flow.element.shadow.endcolor",t="flow.element.shadow.visible",f="flow.element.image",T="flow",B=e.Math.Vector2,P=new B;new B,new B,e.List;var l=e.Default._edgeProtectMethod,k=l.getStraightLinePoints,r=function(N,L){for(var S=[],K=N.length,h=0;K>h;h++){var y=N[h];y._as&&(y=y._as);for(var Z=y[0],G=1;G<y.length;G++)S.push([Z,y[G]]),Z=y[G]}for(var t=[],h=0;h<S.length;h++){var H=z(S[h][0],S[h][1],L);t.push(H)}return{distance:t,segments:S}},w=function(w,d,W){if(w){for(var X,Y=r(w,d),O=Y.distance,s=Y.segments,b=1/0,k=null,G=0,V=O.length;V>G;G++){var T=O[G];T.z<b&&(X=G,b=T.z,k=T)}if(null==W&&(W=.1),k.z<W){for(var g=0,J=0;X>=J;J++)g+=c.getDistance(s[J][0],X>J?s[J][1]:k);return g}}},z=function(D,y,u){var R=D.x,F=D.y,Q=y.x,x=y.y,g=u.x,T=u.y,M=Q-R,w=x-F,C=Math.sqrt(M*M+w*w),e=M/C,S=w/C,O=(-R+g)*e+(-F+T)*S,b={x:R+O*e,y:F+O*S};return b.x>=Math.min(D.x,y.x)&&b.x<=Math.max(D.x,y.x)&&b.y>=Math.min(D.y,y.y)&&b.y<=Math.max(D.y,y.y)||(b.x=Math.abs(b.x-D.x)<Math.abs(b.x-y.x)?D.x:y.x,b.y=Math.abs(b.y-D.y)<Math.abs(b.y-y.y)?D.y:y.y),M=g-b.x,w=T-b.y,b.z=Math.sqrt(M*M+w*w),b},Y=function(R,H){if(R){var d=r(R,H).distance,L=1/0,B=null;return d.forEach(function(r){r.z<L&&(L=r.z,B=r)}),B}},K=l.calculateLineLength,n=l.calcSegmentIndexByDistance,V=l.calculatePointAlongLine,m=function(y,o,d){if(!y)return d;if(0===o){var p=y[0][0],l=y[0][1];return d+Math.atan2(l.y-p.y,l.x-p.x)}if(100===o){y=y[y.length-1];var p=y[y.length-2],l=y[y.length-1];return d+Math.atan2(l.y-p.y,l.x-p.x)}for(var N=0,v=[],q=y.length,X=0;q>X;X++){var h=y[X],f=K(h);N+=f,v.push(f)}for(var P=N*o/100,W=n(P,v),Q=0,R=0;W>R;R++)Q+=v[R];P-=Q;for(var J=V(y[W],P),a=y[W],Z=0,Y=0,c=0;c<a.length-1;c++){var r=a[c],j=a[c+1],x=j.x-r.x,A=j.y-r.y,S=Math.sqrt(x*x+A*A);if(Z+=S,Z>P){Y=c;break}}var e=a[Y];return d+Math.atan2(J.y-e.y,J.x-e.x)},d=function(w){var H=0;if(w)if(Array.isArray(w[0]))for(var J=w.length,W=0;J>W;W++){var j=w[W],y=K(j);H+=y}else H=K(w);return H},W=function(B,W,X,y){return P.set(W,X).rotateAround(null,y),B?{x:B.x+P.x,y:B.y+P.y}:{x:P.x,y:P.y}},G=function(D){var l=D._data,H=k(D);if(H){l.s("flow.reverse")&&(H.reverse(),H.forEach(function(M){M.reverse()}));for(var x=0,J=[],q=H.length,t=0;q>t;t++){var I=H[t],B=K(I);x+=B,J.push(B)}if(l[N]=J,l[u]=x,l[O]=H,l instanceof e.Edge){var L=c.unionPoint(H),n=L.x+L.width/2,z=L.y+L.height/2;l.$10e={x:n,y:z}}y(D,!0)}},i=l.getPercentPosition,y=function(T,p){var o=T._data,w=o[u],k=o.s(g),d=o.s(I),R=0,A=o[N],L=o.s(Z),C=o.s(h),q=o.s(X),W=(L-C)/(q-1),e=[];if(A){if(1===q)e.push(L);else if(2===q)e.push(L),e.push(C);else{if(!(q>2))return;e.push(L);for(var $=q-2;$>0;$--)e.push(C+W*$);e.push(C)}var l=0,i=0;e.forEach(function(g){q-1>l&&(i+=o.getFlowElementSpace(g)),l++}),i+=(L+C)/2,R=(w-k*i+i)/k;var m=T[U];for(null==m&&(m=0),p||(m+=d);m>w+i;){var F=T._overCount;F?F++:F=1,F>=k&&(F=null),T._overCount=F,o.s("flow.autoreverse")?F?m-=R+i:(m=0,o.s("flow.reverse",!o.s("flow.reverse"))):m-=R+i}T[U]=m}},b="prototype",o=e.graph.GraphView[b],a=e.Data[b],A=v.DataUI[b],s=v.ShapeUI[b],_=v.EdgeUI[b],q=e.DataModel[b],p=e.Style;p[Z]==D&&(p[Z]=7),p[h]==D&&(p[h]=0),p[g]==D&&(p[g]=1),p[I]==D&&(p[I]=3),p[X]==D&&(p[X]=10),p[M]==D&&(p[M]=3.5),p[C]==D&&(p[C]=!1),p[E]==D&&(p[E]="rgba(255, 255, 114, 0.4)"),p[S]==D&&(p[S]="rgba(255, 255, 0, 0.3)"),p[H]==D&&(p[H]="rgba(255, 255, 0, 0)"),p[t]==D&&(p[t]=1),p[F]==D&&(p[F]=22),p[L]==D&&(p[L]=4),o.calculatePointLength=function(C,W,Y){var K=this.getDataUI(C),M=k(K);return w(M,W,Y)},c.calculatePointLength=function(r,b,z,d){var G=k(D,r,b);return w(G,z,d)},c.calculateClosestPointOnLine=z,o.calculateClosestPoint=function(p,I){var s=this.getDataUI(p),e=k(s);return Y(e,I)},c.calculateClosestPoint=function(x,V,L){var A=k(D,x,V);return Y(A,L)},o.getPercentAngle=function(r,K){var $=this.getDataUI(r),L=k($);return r.getRotation?r.getRotation():0,m(L,K,r.getRotation?r.getRotation():0)},c.getPercentAngle=function(B,X,v){var s=k(D,B,X);return m(s,v,0)},o.calculateLength=function(c){var N=this.getDataUI(c),m=k(N);return d(m)},c.calculateLength=function(z,j){var Y=k(D,z,j);return d(Y)},o.getPercentPosition=function(D,T){var $=this.getDataUI(D),A=k($);return i(A,T)},c.getPercentPositionOnPoints=function(z,V,L){var W=k(D,z,V);return i(W,L)};var x=function(m){var q=m.data,O=this.dm();if(q&&"add"===m.kind){var Q=O.$3e;Q&&q.s(T)&&Q.indexOf(q)<0&&Q.push(q)}"clear"===m.kind&&(O.$3e=[])},$=function(n){var l=n.property,U=n.data,Z=n.newValue,t=this.dm().$3e;if(t&&"s:flow"===l)if(Z)t.indexOf(U)<0&&t.push(U);else for(var I=t.length,M=0;I>M;M++)if(t[M]===U){t.splice(M,1);break}},J=o.setDataModel;o.setDataModel=function(f){var R=this,Z=R._dataModel;if(Z!==f){Z&&(Z.umm(x,R),Z.umd($,R),Z.$3e=[]),f.mm(x,R),f.md($,R);var p=f.$3e=[];f.each(function(S){S.s(T)&&p.indexOf(S)<0&&p.push(S)}),J.call(R,f)}},a.getFlowElementSpace=function(){return this.s(M)};var j=function(y){var v=this,Q=v._data,R=Q[u],$=Q[N],K=Q[O],s=Q.s(g),d=0,H=v[U],P=Q.s(Z),B=Q.s(h),J=Q.s(X),I=Q.s(L),p=Q.s(F),b=Q.s(C),o=(p-I)/(J-1),i=(P-B)/(J-1),e=Q.getRotation?Q.getRotation():0,r=Q.getPosition?Q.p():Q.$10e,w=[],E=[];if(H!=D){if(1===J)w.push(P);else if(2===J)w.push(P),w.push(B);else{if(!(J>2))return;w.push(P);for(var G=J-2;G>0;G--)w.push(B+i*G);w.push(B)}if(1===J)E.push(p);else if(2===J)E.push(p),E.push(I);else{if(!(J>2))return;E.push(p);for(var G=J-2;G>0;G--)E.push(I+o*G);E.push(I)}var M=0,m=0;w.forEach(function(X){J-1>M&&(m+=Q.getFlowElementSpace(X)),M++}),m+=(P+B)/2,d=(R-s*m+m)/s,y.save();for(var G=0;s>G;G++){var q=H,z=0,l=v._overCount,k=0;Q.s("flow.autoreverse")&&l&&l>s-(G+1)||(q-=G*(d+m),M=0,w.forEach(function(F){var B=q-z;if(B>=0&&R>B){var j=!0,g=n(B,$);k=0;for(var _=0;g>_;_++)k+=$[_];if(B-=k,j){var H=V(K[g],B),T=e;if(b){for(var D=K[g],I=0,u=0,s=0;s<D.length-1;s++){var t=D[s],G=D[s+1],x=G.x-t.x,N=G.y-t.y,f=Math.sqrt(x*x+N*N);if(I+=f,I>B){u=s;break}}var m=D[u];T+=Math.atan2(H.y-m.y,H.x-m.x)}e&&(H=W(r,H.x-r.x,H.y-r.y,e)),v.$5e(y,H,F,E[M],T)}}z+=Q.getFlowElementSpace(w[M]),M++}))}y.restore()}},Td=_._80o;_._80o=function(E){Td.call(this,E);var n=this,K=n._data,I=n.gv;K.s(T)&&I.$7e!=D&&j.call(n,E)};var Kn=s._80o;s._80o=function(B){Kn.call(this,B);var e=this,y=e._data,_=e.gv;y.s(T)&&_.$7e!=D&&j.call(e,B)};var an=_._79o,fo=s._79o,Sl=function(){var d=this,o=d._data,p=o.s(Z),E=!1,x=D;if(d._6I||(E=!0),x=o instanceof e.Edge?an.call(d):fo.call(d),o.s(T)&&E){var f=o.s(F),V=o.s(t);V&&f>p&&(p=f),p>0&&c.grow(x,Math.ceil(p/2)),G(d)}return!o.s(T)&&E&&(o[N]=o[u]=o[O]=d[U]=D),x};s._79o=Sl,_._79o=Sl,A.$5e=function(U,l,p,A,k){var s=this,b=s._data,B=s.gv,e=b.s(E),G=b.s(S),r=b.s(H),h=b.s(t),Y=B.$8e,T=b.s(f);if(Y==D&&(Y=B.$8e={}),U.beginPath(),T!=D){var y=c.getImage(T),v=p/2;U.translate(l.x,l.y),U.rotate(k),U.translate(-l.x,-l.y),c.drawImage(U,y,l.x-v,l.y-v,p,p,b),U.translate(l.x,l.y),U.rotate(-k),U.translate(-l.x,-l.y)}else if(B.__flowBatch){var j=B.__flowBatchGroup;j||(j=B.__flowBatchGroup={});var N=[l.x,l.y,p/2];j[e]?j[e].push(N):j[e]=[N]}else U.fillStyle=e,U.arc(l.x,l.y,p/2,0,2*Math.PI,!0),U.fill();if(h){var V=22,u=V+"_"+G+"_"+r,I=Y[u];if(I==D){var o=document.createElement("canvas");Q.setCanvas(o,V,V);var d=o.getContext("2d"),Z=V/2,i=Z,F=Z;Q.translateAndScale(d,0,0,1),d.beginPath();var O=d.createRadialGradient(i,F,0,i,i,Z);O.addColorStop(0,G),O.addColorStop(1,r),d.fillStyle=O,d.arc(i,F,Z,0,2*Math.PI,!0),d.fill(),I=Y[u]=o}var v=A/2;c.drawImage(U,I,l.x-v,l.y-v,A,A,b)}},o.$9e=function(){var V=this,K=V.dm().$3e;V._24I,K.forEach(function(C){V._24I[C._id]=C}),V.iv()};var Wc=q.prepareRemove;q.prepareRemove=function(o){Wc.call(this,o);var M=o._dataModel,E=M.$3e;if(E)for(var O=E.length,V=0;O>V;V++)if(E[V]===o){E.splice(V,1);break}},o.setFlowInterval=function(C){var E=this,F=E.$11e;E.$11e=C,E.fp("flowInterval",F,C),E.$7e!=D&&(clearInterval(E.$7e),delete E.$7e,E.enableFlow(C))},o.getFlowInterval=function(){return this.$11e},o.enableFlow=function(K){var s=this,f=s.dm(),X=f.$3e;s.$7e==D&&(X.forEach(function(p){var R=s.getDataUI(p);G(R)}),s.$7e=setInterval(function(){f.$3e.forEach(function(q){y(s.getDataUI(q))}),s.$9e()},K||s.$11e||50))},o.disableFlow=function(){var V=this;clearInterval(V.$7e),delete V.$7e;var D=V.dm().$3e;D&&V.$9e()};var Wj=function(){this.__flowBatchGroup={}},ee=function(U){var O=this.__flowBatchGroup;if(O){U.save();for(var S in O){U.fillStyle=S,U.beginPath();var V=O[S];V.forEach(function(P){U.moveTo(P[0],P[1]),U.arc(P[0],P[1],P[2],0,2*Math.PI,!0)}),U.fill()}U.restore()}};o.setFlowBatch=function(B){var _=this;!!_.__flowBatch!=!!B&&(_.__flowBatch=B,B?(_.addBottomPainter(Wj),_.addTopPainter(ee)):(_.removeBottomPainter(Wj),_.removeTopPainter(ee)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);