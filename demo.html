<!DOCTYPE html>
<html>
<head>
    <title>Demo</title>
    <style>
    </style>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="lib/core/ht.js"></script>
    <script type="text/javascript" src="js/ht-value.js"></script>
    <script src="bootstrap-3.3.7-dist/js/jquery-3.1.1.js"></script>
    <script>
        function init() {
            let dataModel = new ht.DataModel(),
                graphView = window.graph = new ht.graph.GraphView(dataModel),
                json = {
                    "v": "7.0.7",
                    "p": {
                        "layers": [
                            "0",
                            1
                        ],
                        "autoAdjustIndex": true,
                        "hierarchicalRendering": false
                    },
                    "d": [
                        {
                            "c": "ht.Text",
                            "i": 2,
                            "p": {
                                "name": "文字",
                                "layer": 1,
                                "tag": "321_CL_PF",
                                "position": {
                                    "x": 625,
                                    "y": -221
                                }
                            },
                            "s": {
                                "text": "0.00",
                                "text.align": "center",
                                "text.font": "16px arial, sans-serif",
                                "label": "",
                                "text.color": "rgb(0,255,0)"
                            }
                        },
                        {
                            "c": "ht.Node",
                            "i": 4,
                            "p": {
                                "name": "旋钮开关",
                                "layer": 1,
                                "tag": "kg-2",
                                "image": "symbols/palette-icon/旋钮开关.json",
                                "position": {
                                    "x": 693,
                                    "y": -141.5
                                }
                            },
                            "s": {
                                "label": ""
                            }
                        },
                        {
                            "c": "ht.Node",
                            "i": 5,
                            "p": {
                                "name": "主变",
                                "layer": 1,
                                "tag": "zb-1",
                                "image": "symbols/palette-icon/主变.json",
                                "position": {
                                    "x": 566.62255,
                                    "y": 35.75118
                                }
                            },
                            "s": {
                                "label": ""
                            }
                        },
                        {
                            "c": "ht.Node",
                            "i": 6,
                            "p": {
                                "name": "主变2",
                                "layer": 1,
                                "tag": "zb-2",
                                "image": "symbols/palette-icon/主变2.json",
                                "position": {
                                    "x": 796.5,
                                    "y": 33.5
                                }
                            },
                            "s": {
                                "label": ""
                            }
                        },
                        {
                            "c": "ht.Node",
                            "i": 80,
                            "p": {
                                "name": "开关",
                                "layer": 1,
                                "tag": "kg-1",
                                "image": "symbols/palette-icon/开关.json",
                                "position": {
                                    "x": 560.5,
                                    "y": -141
                                }
                            },
                            "s": {
                                "label": ""
                            }
                        }
                    ]
                };
            dataModel.deserialize(json);
            graphView.mi(function(e) {
                if (e.kind === 'clickData') {
                    if (e.data.getTag() === 'DJX') {
                        window.location.href = 'index.html';
                    }
                }
            });

            let node = new ht.Node();
            graphView.setMovableFunc(function() {});
            graphView.setSelectableFunc(function() {});
            graphView.setPannable(false);
            graphView.handleScroll = function() {};
            let container = document.getElementById('container');
            graphView.addToDOM(container);
            graphView.fitContent(true);
            setInterval(() => {
                $.getJSON({
                    url: 'WebServer/server/fake-value.json',
                    success: res => {
                        dataModel.setNodeStatusByValue(res.data.ztData);
                    }
                });
            }, 1000);
        }
    </script>
</head>
<body onload="init();">
    <div id="container"></div>
</body>
</html>